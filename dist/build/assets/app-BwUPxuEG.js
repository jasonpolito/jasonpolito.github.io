const k=document.getElementById("flowfield"),C=document.getElementById("fullystacked"),E=k.getContext("2d");let u=C.clientWidth,w=C.clientHeight;k.width=u;k.height=w;const W=20;let $,K,H,U=0;const nt=1e3,V=[];function _(){console.log(C.clientHeight,C.clientWidth),u=C.clientWidth,w=C.clientHeight,k.width=u,k.height=w,$=Math.floor(u/W),K=Math.floor(w/W),H=new Array($*K).fill(0)}window.addEventListener("resize",_);_();class rt{constructor(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=Array.from({length:256},()=>Math.floor(Math.random()*256)),this.perm=[...this.p,...this.p]}dot(t,e,o,r){return t[0]*e+t[1]*o+t[2]*r}noise(t,e,o){const r=.3333333333333333,s=1/6;let M,g,h,S,b=(t+e+o)*r,I=Math.floor(t+b),v=Math.floor(e+b),i=Math.floor(o+b),T=(I+v+i)*s,R=I-T,et=v-T,it=i-T,a=t-R,c=e-et,n=o-it,d,f,y,m,p,x;a>=c?c>=n?(d=1,f=0,y=0,m=1,p=1,x=0):a>=n?(d=1,f=0,y=0,m=1,p=0,x=1):(d=0,f=0,y=1,m=1,p=0,x=1):c<n?(d=0,f=0,y=1,m=0,p=1,x=1):a<n?(d=0,f=1,y=0,m=0,p=1,x=1):(d=0,f=1,y=0,m=1,p=1,x=0);let B=a-d+s,D=c-f+s,L=n-y+s,N=a-m+2*s,G=c-p+2*s,J=n-x+2*s,X=a-1+3*s,Y=c-1+3*s,Z=n-1+3*s,F=I&255,P=v&255,O=i&255,st=this.perm[F+this.perm[P+this.perm[O]]]%12,lt=this.perm[F+d+this.perm[P+f+this.perm[O+y]]]%12,ot=this.perm[F+m+this.perm[P+p+this.perm[O+x]]]%12,ht=this.perm[F+1+this.perm[P+1+this.perm[O+1]]]%12,j=.6-a*a-c*c-n*n;j<0?M=0:(j*=j,M=j*j*this.dot(this.grad3[st],a,c,n));let q=.6-B*B-D*D-L*L;q<0?g=0:(q*=q,g=q*q*this.dot(this.grad3[lt],B,D,L));let z=.6-N*N-G*G-J*J;z<0?h=0:(z*=z,h=z*z*this.dot(this.grad3[ot],N,G,J));let A=.6-X*X-Y*Y-Z*Z;return A<0?S=0:(A*=A,S=A*A*this.dot(this.grad3[ht],X,Y,Z)),32*(M+g+h+S)}}const at=new rt;function ct(){let l=0;for(let t=0;t<K;t++)for(let e=0;e<$;e++){const o=at.noise(e*.1,t*.1,U)*Math.PI*2;H[l++]=o}}class dt{constructor(){this.reset()}reset(){this.x=Math.random()*u,this.y=Math.random()*w,this.vx=0,this.vy=0,this.speed=1,this.history=[]}update(){const t=Math.floor(this.x/W),o=Math.floor(this.y/W)*$+t;if(H[o]!==void 0){const r=H[o];this.vx+=Math.cos(r)*.1,this.vy+=Math.sin(r)*.1}this.vx*=.9,this.vy*=.9,this.x+=this.vx,this.y+=this.vy,this.history.push([this.x,this.y]),this.history.length>5&&this.history.shift(),(this.x<0||this.x>u||this.y<0||this.y>w)&&this.reset()}draw(t){if(!(this.history.length<2)){t.beginPath(),t.moveTo(this.history[0][0],this.history[0][1]);for(let e=1;e<this.history.length;e++)t.lineTo(this.history[e][0],this.history[e][1]);t.strokeStyle="rgba(188, 58, 160, 0.2)",t.lineWidth=1,t.stroke()}}}for(let l=0;l<nt;l++)V.push(new dt);function tt(){E.globalCompositeOperation="destination-out",E.fillStyle="rgba(0, 0, 0, 0.1)",E.fillRect(0,0,u,w),E.globalCompositeOperation="lighter",U+=.003,ct(),V.forEach(l=>{l.update(),l.draw(E)}),requestAnimationFrame(tt)}tt();setTimeout(()=>{k.classList.remove("opacity-0")},100);const Q=document.querySelectorAll("[data-word-rotator]");Q.length&&Q.forEach(l=>{const t={text1:l.querySelector(".text1"),text2:l.querySelector(".text2")},e=JSON.parse(l.dataset.wordRotator),o=1,r=.5;let s=e.length-1,M=new Date,g=0,h=r;t.text1.textContent=e[s%e.length],t.text2.textContent=e[(s+1)%e.length];function S(){g-=h,h=0;let i=g/o;i>1&&(h=r,i=1),b(i)}function b(i){t.text2.style.filter=`blur(${Math.min(8/i-8,100)}px)`,t.text2.style.opacity=`${Math.pow(i,.4)*100}%`,i=1-i,t.text1.style.filter=`blur(${Math.min(8/i-8,100)}px)`,t.text1.style.opacity=`${Math.pow(i,.4)*100}%`,t.text1.textContent=e[s%e.length],t.text2.textContent=e[(s+1)%e.length]}function I(){g=0,t.text2.style.filter="",t.text2.style.opacity="100%",t.text1.style.filter="",t.text1.style.opacity="0%"}function v(){requestAnimationFrame(v);let i=new Date,T=h>0,R=(i-M)/1e3;M=i,h-=R,h<=0?(T&&s++,S()):I()}v()});
